<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="description" content="SGK Global Shipping Export Documentation">
    <meta name="theme-color" content="#4169E1">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <meta name="format-detection" content="telephone=no">
    <title>{% block title %}SGK Global Shipping{% endblock %}</title>
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SGK Export">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    
    <!-- PWA Icons -->
    <link rel="icon" href="{{ url_for('static', filename='images/icons/icon-72x72.png') }}" sizes="72x72">
    <link rel="icon" href="{{ url_for('static', filename='images/icons/icon-96x96.png') }}" sizes="96x96">
    <link rel="icon" href="{{ url_for('static', filename='images/icons/icon-128x128.png') }}" sizes="128x128">
    <link rel="icon" href="{{ url_for('static', filename='images/icons/icon-144x144.png') }}" sizes="144x144">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/icons/icon-152x152.png') }}" sizes="152x152">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/icons/icon-192x192.png') }}" sizes="192x192">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/icons/icon-384x384.png') }}" sizes="384x384">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/icons/icon-512x512.png') }}" sizes="512x512">
    <link rel="apple-touch-startup-image" href="{{ url_for('static', filename='images/icons/splash-640x1136.png') }}" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="{{ url_for('static', filename='images/icons/splash-750x1334.png') }}" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="{{ url_for('static', filename='images/icons/splash-1242x2208.png') }}" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="{{ url_for('static', filename='images/icons/splash-1125x2436.png') }}" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="{{ url_for('static', filename='images/icons/splash-1536x2048.png') }}" media="(min-device-width: 768px) and (max-device-width: 1024px) and (-webkit-min-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="{{ url_for('static', filename='images/icons/splash-1668x2224.png') }}" media="(min-device-width: 834px) and (max-device-width: 834px) and (-webkit-min-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="{{ url_for('static', filename='images/icons/splash-2048x2732.png') }}" media="(min-device-width: 1024px) and (max-device-width: 1024px) and (-webkit-min-device-pixel-ratio: 2) and (orientation: portrait)">
    
    <!-- Critical CSS -->
    {{ critical_css|safe }}
    
    <!-- Deferred CSS with Resource Hints -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preload" href="{{ url_for('static', filename='css/main.css') }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    
    <!-- Fallback for JavaScript-disabled browsers -->
    <noscript>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    </noscript>
    
    <!-- Third-party CSS -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    
    <!-- CSS Loading Script -->
    <script>
      /* Update to use a working CDN that hosts loadCSS */
      (function(w){"use strict";var loadCSS=function(href,before,media,attributes){var doc=w.document;var ss=doc.createElement("link");var ref;if(before){ref=before}else{var refs=(doc.body||doc.getElementsByTagName("head")[0]).childNodes;ref=refs[refs.length-1]}var sheets=doc.styleSheets;if(attributes){for(var key in attributes){if(attributes.hasOwnProperty(key)){ss.setAttribute(key,attributes[key])}}}ss.rel="stylesheet";ss.href=href;ss.media="only x";function ready(cb){if(doc.body){return cb()}setTimeout(function(){ready(cb)})}ready(function(){ref.parentNode.insertBefore(ss,(before?ref:ref.nextSibling))});var onloadcssdefined=function(cb){var resolvedHref=ss.href;var i=sheets.length;while(i--){if(sheets[i].href===resolvedHref){return cb()}}setTimeout(function(){onloadcssdefined(cb)})};function loadCB(){if(ss.addEventListener){ss.removeEventListener("load",loadCB)}ss.media=media||"all"}if(ss.addEventListener){ss.addEventListener("load",loadCB)}ss.onloadcssdefined=onloadcssdefined;onloadcssdefined(loadCB);return ss};if(typeof exports!=="undefined"){exports.loadCSS=loadCSS}else{w.loadCSS=loadCSS}})(typeof global!=="undefined"?global:this);
    </script>
    
    <!-- Page-specific CSS -->
    {% block extra_head %}{% endblock %}
    
    <!-- Analytics (Assuming you have analytics) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXX-Y"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-XXXXX-Y');
    </script>
</head>
<body class="{% if request.endpoint == 'auth.login' %}login-page{% elif request.endpoint == 'main.print_form_template' %}print-form-page{% endif %} {% block body_class %}{% endblock %}">
    <nav class="sticky-nav" role="navigation" aria-label="Main navigation">
        <div class="main-nav">
            <div class="nav-brand">
                <img src="{{ url_for('static', filename='images/SGKlogo.png') }}" alt="SGK Global Shipping Logo" class="nav-logo" width="40" height="40">
                <span class="brand-text">SGK Global Shipping</span>
            </div>
            {% if current_user.is_authenticated %}
            <button class="mobile-menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false" aria-controls="nav-links">
                <i class="fas fa-bars" aria-hidden="true"></i>
            </button>
            <div class="nav-links" id="nav-links">
                <div class="nav-section primary-actions" role="group" aria-label="Primary actions">
                    <h2 class="visually-hidden">Primary Navigation</h2>
                    <a href="{{ url_for('main.dashboard') }}" class="nav-link {% if request.endpoint == 'main.dashboard' %}active{% endif %}" aria-current="{% if request.endpoint == 'main.dashboard' %}page{% endif %}" data-tooltip="Dashboard">
                        <i class="fas fa-tachometer-alt" aria-hidden="true"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="{{ url_for('shipments.new_shipment') }}" class="nav-link {% if request.endpoint == 'shipments.new_shipment' %}active{% endif %}" aria-current="{% if request.endpoint == 'shipments.new_shipment' %}page{% endif %}" data-tooltip="New Shipment">
                        <i class="fas fa-file-export" aria-hidden="true"></i>
                        <span>New Shipment</span>
                    </a>
                    <a href="{{ url_for('shipments.list_shipments') }}" class="nav-link {% if request.endpoint == 'shipments.list_shipments' %}active{% endif %}" aria-current="{% if request.endpoint == 'shipments.list_shipments' %}page{% endif %}" data-tooltip="Shipment List">
                        <i class="fas fa-list" aria-hidden="true"></i>
                        <span>Shipment List</span>
                    </a>
                </div>
                <a href="{{ url_for('main.print_form_template') }}" class="nav-link {% if request.endpoint == 'main.print_form_template' %}active{% endif %}" aria-current="{% if request.endpoint == 'main.print_form_template' %}page{% endif %}" data-tooltip="Print Form">
                    <i class="fas fa-print" aria-hidden="true"></i>
                    <span>Print Form</span>
                </a>
                <div class="nav-section" role="group" aria-label="Contact management">
                    <div class="nav-item dropdown">
                        <button class="nav-link dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" data-tooltip="Contacts">
                            <i class="fas fa-address-book" aria-hidden="true"></i>
                            <span>Contacts</span>
                        </button>
                        <ul class="dropdown-menu" role="menu">
                            <li>
                                <a class="dropdown-item" href="{{ url_for('contacts.list_senders') }}" role="menuitem" data-tooltip="Senders">
                                    <i class="fas fa-user-tie" aria-hidden="true"></i>
                                    <span>Senders</span>
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{{ url_for('contacts.list_receivers') }}" role="menuitem">
                                    <i class="fas fa-user-check" aria-hidden="true"></i>
                                    <span>Receivers</span>
                                </a>
                            </li>
                            <li><hr class="dropdown-divider" role="separator"></li>
                            <li>
                                <a class="dropdown-item" href="{{ url_for('contacts.list_all_contacts') }}" role="menuitem">
                                    <i class="fas fa-users" aria-hidden="true"></i>
                                    <span>All Contacts</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                </div>

                {% if current_user.is_admin or current_user.is_superuser %}
                <div class="nav-section admin-section" role="group" aria-label="Administration">
                    <div class="nav-item dropdown">
                        <button class="nav-link dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" data-tooltip="Administration">
                            <i class="fas fa-shield-alt" aria-hidden="true"></i>
                            <span>Administration</span>
                        </button>
                        <ul class="dropdown-menu" role="menu">
                            {% if current_user.is_admin %}
                            <li>
                                <a class="dropdown-item" href="{{ url_for('admin.manage_users') }}" role="menuitem">
                                    <i class="fas fa-users" aria-hidden="true"></i>
                                    <span>Manage Users</span>
                                </a>
                            </li>
                            {% endif %}
                            {% if current_user.is_superuser %}
                            <li>
                                <a class="dropdown-item" href="{{ url_for('admin.manage_admins') }}" role="menuitem">
                                    <i class="fas fa-user-shield" aria-hidden="true"></i>
                                    <span>Manage Administrators</span>
                                </a>
                            </li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
                {% endif %}

                <div class="nav-section user-section" role="group" aria-label="User menu">
                    <div class="user-menu dropdown">
                        <button class="nav-link dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">
                            <i class="fas fa-user" aria-hidden="true"></i>
                            <span class="user-name">{{ current_user.name }}</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" role="menu">
                            <li>
                                <a class="dropdown-item" href="{{ url_for('profile.index') }}" role="menuitem">
                                    <i class="fas fa-user" aria-hidden="true"></i>
                                    <span>My Profile</span>
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{{ url_for('auth.change_password') }}" role="menuitem">
                                    <i class="fas fa-key" aria-hidden="true"></i>
                                    <span>Change Password</span>
                                </a>
                            </li>
                            <li><hr class="dropdown-divider" role="separator"></li>
                            <li>
                                <a class="dropdown-item" href="{{ url_for('auth.logout') }}" role="menuitem">
                                    <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
                                    <span>Logout</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <!-- Offline Status Indicator in Navigation -->
                <div class="nav-section offline-section offline-only" role="group" aria-label="Offline status">
                    <div class="nav-item">
                        <span class="nav-link offline-indicator-nav">
                            <i class="fas fa-wifi-slash" aria-hidden="true"></i>
                            <span>Offline Mode</span>
                        </span>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </nav>

    <main class="main-content">
        <div class="container">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            
            <!-- Offline Mode Banner (only shown when offline) -->
            <div class="offline-banner offline-only">
                <div class="offline-banner-icon">ðŸ“¶</div>
                <div class="offline-banner-content">
                    <p class="offline-banner-title">You're in offline mode</p>
                    <p class="offline-banner-message">Some features may be limited. Changes will sync when you reconnect.</p>
                </div>
            </div>
            
            {% block content %}{% endblock %}
        </div>
    </main>

    <footer class="app-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-company">
                    <img src="{{ url_for('static', filename='images/SGKlogo.png') }}" alt="SGK Global Shipping Logo" class="footer-logo" width="30" height="30">
                    <p>Â© 2023 SGK Global Shipping</p>
                </div>
                <div class="footer-links">
                    <a href="{{ url_for('main.terms') }}">Terms & Conditions</a>
                    <a href="#" data-bs-toggle="modal" data-bs-target="#privacyPolicyModal">Privacy Policy</a>
                    <a href="#" data-bs-toggle="modal" data-bs-target="#contactSupportModal">Support</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript Dependencies -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    
    <!-- Offline Support JavaScript -->
    <script type="module" src="{{ url_for('static', filename='js/modules/offline.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/modules/offline-form.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/modules/offline-navigation.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/modules/api-service.js') }}"></script>
    
    <!-- Application JavaScript -->
    <script type="module" src="{{ url_for('static', filename='js/modules/navigation.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/modules/modal.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/modules/validation.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    <!-- Page-specific JavaScript -->
    {% block scripts %}{% endblock %}
    
    <!-- Accessibility & Service Worker -->
    <script>
        // Enable focus outlines only when using keyboard navigation
        document.body.addEventListener('mousedown', function() {
            document.body.classList.add('using-mouse');
        });
        document.body.addEventListener('keydown', function(e) {
            if (e.key === 'Tab') {
                document.body.classList.remove('using-mouse');
            }
        });
        
        // Register service worker for offline support
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js').then(function(registration) {
                    console.log('ServiceWorker registration successful');
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
    
    <!-- Offline CSS -->
    <style>
        /* Offline Banner */
        .offline-banner {
            background-color: #ff9800;
            color: white;
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 16px;
            display: none;
            align-items: center;
        }
        
        .offline-banner-icon {
            margin-right: 12px;
            font-size: 20px;
        }
        
        .offline-banner-title {
            font-weight: bold;
            margin: 0;
            font-size: 16px;
        }
        
        .offline-banner-message {
            margin: 4px 0 0 0;
            font-size: 14px;
        }
        
        /* Offline Indicator in Nav */
        .offline-indicator-nav {
            background-color: #f44336;
            color: white;
            border-radius: 4px;
            padding: 6px 12px;
        }
        
        .offline-indicator-nav i {
            margin-right: 8px;
        }
        
        /* Show/hide based on offline status */
        body.is-offline .online-only {
            display: none !important;
        }
        
        body.is-offline .offline-only {
            display: flex !important;
        }
        
        body:not(.is-offline) .offline-only {
            display: none !important;
        }
    </style>
</body>
</html> 